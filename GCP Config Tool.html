	<html>
	  <head>
		<meta charset="utf-8">
		<title>
		  CloudHealth GCP Config Script Tool
		</title>
	  </head>
	  <body>
		  <br>
		  <div class="margin" id="margin">
		  <h1>CloudHealth GCP Config Script</h1>
		  <h2>Script At Project Level:</h2>
		  <p>Fill in the below text boxes & click the "Generate Script" button:</p>
		<div id="projId">
		  <input type="text" id="projIdInput" placeholder="Paste Project ID" reqired>
		</div>
		<br />
		<div id="bucketName">
		  <input type="text" id="bucketNameInput" placeholder="Paste Bucket Name" required>
		</div>
		<br />
		<div id="bucketId">
		  <input type="text" id="bucketIdInput" placeholder="Paste Bucket ID" required>
		</div>
		<p>Check box to enable BigQuery? <input type="checkbox" id="bqProjCheck"></p>
		<div id="bqProjId">
		  <input type="text" id="bqProjIdInput" placeholder="Paste BQ Proj ID" required>
		</div>
		<br />
		<button onclick="generateProjScript()">Generate Script</button>
		  <p>Click the "Copy" button & paste the script into the GCP CLI:</p>
		  <input type="text" id="projScriptTextBox" required>
		<button onclick="copyProjScript()">Copy</button>

			<script>
			const templateProjScript = 'gcloud services enable cloudbilling.googleapis.com compute.googleapis.com cloudresourcemanager.googleapis.com storage-component.googleapis.com  --project <insert project id>     gcloud iam roles create cloudhealthcustomrole --project <insert project id> \     --title cloudhealthcustomrole --description \     "Used to collect CloudHealth Billing and Usage data" --permissions \     resourcemanager.projects.get,compute.disks.get,compute.disks.list,compute.images.get,compute.images.list,compute.instances.get,compute.instances.list,compute.projects.get,compute.regions.get,compute.regions.list,storage.buckets.list,bigquery.datasets.get,bigquery.jobs.create,dataproc.clusters.list,compute.addresses.list,container.clusters.list,bigquery.tables.get,bigquery.tables.getData,compute.snapshots.get,compute.snapshots.list,compute.zones.get,compute.zones.list \     --stage GA wait    gcloud iam service-accounts create cloudhealthserviceaccount --project <insert project id> wait    gcloud iam service-accounts keys create \     --iam-account cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com chtsakey.json wait    cloudshell download chtsakey.json wait   gcloud projects add-iam-policy-binding <insert project id> --member serviceAccount:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --role projects/<insert project id>/roles/cloudhealthcustomrole wait    gcloud projects add-iam-policy-binding <insert project id> --member serviceAccount:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --role roles/recommender.computeViewer wait    gcloud projects add-iam-policy-binding <insert project id> --member user:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --member serviceAccount:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --role projects/<insert project id>/roles/cloudhealthcustomrole     gcloud projects add-iam-policy-binding <insert project id> --member user:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --member serviceAccount:cloudhealthserviceaccount@<insert project id>.iam.gserviceaccount.com \     --role roles/recommender.computeViewer wait     ';
			const bqStringTemplate = 'cloudhealthserviceaccount@<insert bq project id>.iam.gserviceaccount.com';

			function createNode(element) {
			  return document.createElement(element);
			}

			function append(parent, el) {
			  return parent.appendChild(el);
			}

			function generateProjScript() {
			  var projIdInput = document.getElementById("projIdInput").value;
			  var bqProjIdInput = document.getElementById("bqProjIdInput").value;
			  var bucketNameInput = document.getElementById("bucketNameInput").value;
			  var bucketIdInput = document.getElementById("bucketIdInput").value;
  			  var bqProjInput = document.getElementById("bqProjCheck").value;
			  	if (bqProjCheck.checked == true){
			    bqProjString = bqStringTemplate;
			    } else {
 				    bqProjString = "";
  				};
			  var generatedProjScript = templateProjScript
			  	.replace(/<insert project id>/gi,projIdInput)
			  	.replace(/<insert bucket name>/gi,bucketNameInput)
			  	.replace(/<insert bucket id>/gi,bucketIdInput) + bqProjString.replace(/<insert bq project id>/gi,bqProjIdInput);
				document.getElementById("projScriptTextBox").value = generatedProjScript;
			}

			function copyProjScript() {
			  var copyProjText = document.getElementById("projScriptTextBox");
				copyProjText.select();
				document.execCommand("copy");
			  };
			</script>
			</div>
			<br />
			<div class="margin" id="margin">
				<h2>Script At Org Level:</h2>
				<p>Fill in the below text boxes & click the "Generate Script" button:</p>
				<div id="orgId">
					<input type="text" id="orgIdInput" placeholder="Paste Org ID" reqired>
				</div>
				<br />
				<div id="orgBucketName">
					<input type="text" id="orgBucketNameInput" placeholder="Paste Bucket Name" required>
				</div>
				<br />
				<div id="orgBucketId">
					<input type="text" id="orgBucketIdInput" placeholder="Paste Bucket ID" required>
				</div>
				<br />
				<div id="orgProjId">
					<input type="text" id="orgProjIdInput" placeholder="Paste Project ID" required>
				</div>
				<p>Check box to enable BigQuery? <input type="checkbox" id="bqOrgCheck"></p>
				<div id="bqOrgId">
				  <input type="text" id="bqOrgIdInput" placeholder="Paste BQ Proj ID" required>
				</div>
				<br />
				<button onclick="generateOrgScript()">Generate Script</button>
				<p>Click the "Copy" button & paste the script into the GCP CLI:</p>
				<input type="text" id="orgScriptTextBox" required>
				<button onclick="copyOrgScript()">Copy</button>
			<script>
			const templateOrgScript = 'gcloud iam roles create cloudhealthcustomrole --organization <insert org id2> \ --title cloudhealthcustomrole --description \ "Used to collect CloudHealth Billing and Usage data" --permissions \ resourcemanager.projects.get,compute.disks.get,compute.disks.list,compute.images.get,compute.images.list,compute.instances.get,compute.instances.list,compute.projects.get,compute.regions.get,compute.regions.list,storage.buckets.list,bigquery.datasets.get,bigquery.jobs.create,dataproc.clusters.list,compute.addresses.list,container.clusters.list,bigquery.tables.get,bigquery.tables.getData,compute.snapshots.get,compute.snapshots.list,compute.zones.get,compute.zones.list,recommender.computeInstanceMachineTypeRecommendations.get,recommender.computeInstanceMachineTypeRecommendations.list,recommender.locations.get,recommender.locations.list \ --stage GA wait     gcloud iam service-accounts create cloudhealthserviceaccount --project <insert project id2> wait     gcloud iam service-accounts keys create \ --iam-account cloudhealthserviceaccount@<insert project id2>.iam.gserviceaccount.com chtsakey.json wait     cloudshell download chtsakey.json wait     gcloud projects add-iam-policy-binding <insert project id2> --member serviceAccount:cloudhealthserviceaccount@<insert project id2>.iam.gserviceaccount.com \ --role organizations/<insert org id2>/roles/cloudhealthcustomrole wait     gcloud organizations add-iam-policy-binding <insert org id2> --member user:cloudhealthserviceaccount@<insert project id2>.iam.gserviceaccount.com \ --member serviceAccount:cloudhealthserviceaccount@<insert project id2>.iam.gserviceaccount.com \ --role organizations/<insert org id2>/roles/cloudhealthcustomrole wait     gsutil mb -c regional -l us-east1 -p <insert project id2> gs://<insert bucket name2> wait     gsutil iam ch serviceAccount:cloudhealthserviceaccount@<insert project id2>.iam.gserviceaccount.com:objectViewer gs://<insert bucket name2> wait     for project in $(gcloud projects list --format="value(<insert project id2>)") do    echo "ProjectId: $project"    gcloud config set project $project    gcloud services enable cloudbilling.googleapis.com compute.googleapis.com cloudresourcemanager.googleapis.com recommender.googleapis.com storage-component.googleapis.com storage-api.googleapis.com --project $project done wait     ';
			const bqOrgStringTemplate = 'bq mk <insert bq org project id>:billing';

			function createNode(element) {
			  return document.createElement(element);
			}

			function append(parent, el) {
			  return parent.appendChild(el);
			}

			function generateOrgScript() {
			  var orgIdInput = document.getElementById("orgIdInput").value;
			  var orgBucketNameInput = document.getElementById("orgBucketNameInput").value;
			  var orgBucketIdInput = document.getElementById("orgBucketIdInput").value;
			  var orgProjIdInput = document.getElementById("orgProjIdInput").value;
  			  var bqOrgInput = document.getElementById("bqOrgCheck").value;
			  	if (bqOrgCheck.checked == true){
			    bqOrgString = bqOrgStringTemplate;
			    } else {
 				    bqOrgString = "";
  				};
			  var generatedOrgScript = templateOrgScript
			  	.replace(/<insert org id2>/gi,orgIdInput)
			  	.replace(/<insert bucket name2>/gi,orgBucketNameInput)
			  	.replace(/<insert bucket id2>/gi,orgBucketIdInput)
			  	.replace(/<insert project id2>/gi,orgProjIdInput) + bqOrgString.replace(/<insert bq org project id>/gi,bqOrgIdInput);
				document.getElementById("orgScriptTextBox").value = generatedOrgScript;
			}

			function copyOrgScript() {
			  var copyOrgText = document.getElementById("orgScriptTextBox");
				copyOrgText.select();
				document.execCommand("copy");
			  };
		</script>


			<div>
			<br />
		  <h2>Bucket Configuration (Legacy Billing CSV)</h2>
		  <p>Fill in the below text boxes & click the "Generate Script" button:</p>
		<div id="projId">
		  <input type="text" id="legacyProjIdInput" placeholder="Paste Project ID" reqired>
		</div>
		<br />
		<div id="legacyBucketName">
		  <input type="text" id="legacyBucketNameInput" placeholder="Paste Bucket Name" required>
		</div>
		<br />
		<button onclick="generateLegacyScript()">Generate Script</button>
		  <p>Click the "Copy" button & paste the script into the GCP CLI:</p>
		  <input type="text" id="legacyScriptTextBox" required>
		<button onclick="copyLegacyScript()">Copy</button>
			</script>
			</div>
			<script>
			const templateLegacyScript = 'gsutil mb -c regional -l us-east1 -p <insert project id3> gs://<insert bucket name3>     gsutil iam ch serviceAccount:cloudhealthserviceaccount@<insert project id3>.iam.gserviceaccount.com:objectViewer gs://';

			function createNode(element) {
			  return document.createElement(element);
			}

			function append(parent, el) {
			  return parent.appendChild(el);
			}

			function generateLegacyScript() {
			  var projIdInput = document.getElementById("legacyProjIdInput").value;
			  var bucketNameInput = document.getElementById("legacyBucketNameInput").value;
			  var generatedLegacyScript = templateLegacyScript
			  	.replace(/<insert project id3>/gi,legacyProjIdInput)
			  	.replace(/<insert bucket name3>/gi,legacyBucketNameInput);
				document.getElementById("legacyScriptTextBox").value = generatedLegacyScript;
			}

			function copyLegacyScript() {
			  var copyLegacyText = document.getElementById("legacyScriptTextBox");
				copyLegacyText.select();
				document.execCommand("copy");
			  };
			</script>
			</div>
			<style>
				#externalId {
				  padding:7px;
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#externalIdInput {
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#accountName {
				  padding:7px;
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#accountNameInput {
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#policyArn {
				  padding:7px;
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#policyArnInput {
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#json {
				  font-size: 14px;
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				}

				#margin {
				  margin-left: 20px;
				}

				h1 {
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				  font-size: 32px;
				}

				h2 {
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				  font-size: 21.6px;
				  color: 0079B8;
				}

				p {
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				  font-size: 14px;
				  color: 565656;
				}

				a {
				  font-family: Metropolis,"Avenir Next","Helvetica Neue",Arial,sans-serif;
				  font-size: 14px;
				  color: 0079B8;  
				}
			</style>
		</body>
	</html>
